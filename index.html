<!DOCTYPE html>
<html lang="en" style="scroll-behavior: smooth;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PicoPay | Cheap In-Game Currency & Box Live</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for a dark theme with green accents -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#0a0a0a',
                        'secondary-dark': '#1f2937',
                        'accent-green': '#10b981', // Emerald green for the glow
                        'accent-yellow': '#eab308', // Yellow for admin actions
                        'text-light': '#f3f4f6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <!-- Use Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for a glowing effect */
        .glow-text {
            text-shadow: 0 0 8px rgba(16, 185, 129, 0.7); /* accent-green glow */
        }
        .glow-button {
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5); /* accent-green glow */
            transition: box-shadow 0.3s ease-in-out, transform 0.1s ease-in-out;
        }
        .glow-button:hover {
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.9);
            transform: translateY(-2px);
        }
        /* Admin specific glow */
        .admin-glow-button {
            box-shadow: 0 0 10px rgba(234, 179, 8, 0.5);
            transition: box-shadow 0.3s ease-in-out, transform 0.1s ease-in-out;
        }
        .admin-glow-button:hover {
            box-shadow: 0 0 15px rgba(234, 179, 8, 0.9);
            transform: translateY(-2px);
        }

        /* Style for the hidden modal backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 60;
            transition: opacity 0.3s ease;
        }
        
        /* Modal Content Animation States */
        .modal-content-hidden {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-content-visible {
            opacity: 1;
            transform: scale(1);
        }

        /* Animation for the flying cart particle */
        .fly-item {
            position: fixed;
            z-index: 9999;
            width: 20px;
            height: 20px;
            background-color: #10b981;
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.8);
            transition: all 0.8s cubic-bezier(0.19, 1, 0.22, 1);
        }

        /* Cart shake animation */
        @keyframes cart-shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
        }
        .cart-shake {
            animation: cart-shake 0.4s ease-in-out;
            color: #10b981; /* Turn green while shaking */
        }

        /* Prevent double-tap zoom on buttons */
        .add-to-cart-btn {
            touch-action: manipulation;
        }
    </style>
</head>
<body class="bg-primary-dark text-text-light font-sans min-h-screen antialiased">

    <!-- Use Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght{400;600;800}&display=swap" rel="stylesheet">
</head>
<body class="bg-primary-dark text-text-light font-sans min-h-screen antialiased">

    <!-- Header & Navigation -->
    <header class="bg-secondary-dark/50 backdrop-blur-sm sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <!-- Logo Area -->
            <div class="flex items-center space-x-2 cursor-pointer" onclick="window.scrollTo(0,0)">
                <img 
                    src="https://placehold.co/150x50/10b981/ffffff?text=P" 
                    onerror="this.onerror=null;this.src='https://placehold.co/50x50/10b981/ffffff?text=P'" 
                    alt="PicoPay Logo" 
                    class="h-10 w-10 rounded-full border-2 border-accent-green"
                >
                <span class="text-2xl font-extrabold tracking-tighter hover:text-accent-green transition duration-300">PicoPay</span>
            </div>
            
            <!-- Desktop Navigation -->
            <nav class="hidden md:flex space-x-8 items-center">
                <a href="#products" class="nav-link text-text-light hover:text-accent-green transition duration-300">Products</a>
                <a href="#features" class="nav-link text-text-light hover:text-accent-green transition duration-300">Why Us?</a>
                <a href="#contact" class="nav-link text-text-light hover:text-accent-green transition duration-300">Contact</a>
                
                <!-- Admin Dashboard Button (Hidden by default) -->
                <button id="admin-dashboard-btn" onclick="openAdminDashboard()" class="hidden text-accent-yellow hover:text-white font-bold border border-accent-yellow/50 rounded-lg px-3 py-1 bg-accent-yellow/10 transition items-center">
                    Admin Dashboard
                </button>

                <!-- Desktop Cart Button -->
                <button id="cart-button-desktop" class="relative p-2 text-text-light hover:text-accent-green transition duration-300" onclick="openCartModal()">
                    <svg id="cart-icon-desktop" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 12.42a2 2 0 0 0 2 1.58h9.32a2 2 0 0 0 2-1.58L23 6H6"></path></svg>
                    <span id="cart-count-desktop" class="absolute -top-1 -right-1 bg-red-600 text-xs text-white rounded-full h-5 w-5 flex items-center justify-center scale-0 transition-transform duration-200">0</span>
                </button>

                <!-- Dynamic Auth Button Desktop -->
                <button id="auth-btn-desktop" onclick="handleAuthClick()" class="nav-link text-text-light bg-accent-green/10 px-4 py-2 rounded-lg hover:bg-accent-green/30 transition duration-300 border border-accent-green/20">
                    Sign In
                </button>
            </nav>

            <!-- Mobile Menu Area (Cart Icon + Hamburger) -->
            <div class="md:hidden flex items-center space-x-4">
                <!-- Mobile Header Cart Button -->
                <button id="cart-button-mobile" class="relative p-2 text-text-light hover:text-accent-green transition duration-300" onclick="openCartModal()">
                    <svg id="cart-icon-mobile" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 12.42a2 2 0 0 0 2 1.58h9.32a2 2 0 0 0 2-1.58L23 6H6"></path></svg>
                    <span id="cart-count-mobile-header" class="absolute -top-1 -right-1 bg-red-600 text-xs text-white rounded-full h-5 w-5 flex items-center justify-center scale-0 transition-transform duration-200">0</span>
                </button>

                <!-- Mobile Menu Button -->
                <button id="menu-button" class="p-2 text-text-light hover:text-accent-green transition duration-300" onclick="toggleMobileMenu()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="hidden md:hidden bg-secondary-dark/95 border-t border-accent-green/20 absolute w-full left-0 top-full z-[40]">
            <nav class="flex flex-col space-y-2 p-4 shadow-xl">
                <button id="admin-dashboard-btn-mobile" onclick="openAdminDashboard(); toggleMobileMenu();" class="hidden w-full text-left py-2 px-3 text-accent-yellow bg-accent-yellow/10 rounded-md hover:bg-accent-yellow/20 font-bold transition">
                    Admin Dashboard
                </button>
                <a href="#products" class="block py-2 px-3 hover:bg-accent-green/20 rounded-md transition duration-300 text-text-light" onclick="toggleMobileMenu()">Products</a>
                <a href="#features" class="block py-2 px-3 hover:bg-accent-green/20 rounded-md transition duration-300 text-text-light" onclick="toggleMobileMenu()">Why Us?</a>
                <a href="#contact" class="block py-2 px-3 hover:bg-accent-green/20 rounded-md transition duration-300 text-text-light" onclick="toggleMobileMenu()">Contact</a>
                <button id="auth-btn-mobile" onclick="handleAuthClick(); toggleMobileMenu();" class="w-full text-left py-2 px-3 bg-accent-green/10 rounded-md hover:bg-accent-green/30 transition duration-300 text-text-light border border-accent-green/20">
                    Sign In
                </button>
                <button class="w-full py-2 px-3 text-left relative hover:bg-accent-green/20 rounded-md transition duration-300 flex items-center justify-start space-x-2 text-text-light" onclick="openCartModal(); toggleMobileMenu();">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 12.42a2 2 0 0 0 2 1.58h9.32a2 2 0 0 0 2-1.58L23 6H6"></path></svg>
                    <span>Cart</span>
                    <span id="cart-count-mobile" class="ml-auto bg-red-600 text-xs text-white rounded-full h-5 w-5 flex items-center justify-center scale-0 transition-transform duration-200">0</span>
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <section class="text-center py-12 md:py-24">
            <h1 class="text-4xl sm:text-6xl md:text-7xl font-extrabold mb-4 leading-tight">
                Unlock <span class="text-accent-green glow-text">Peak Gaming</span> Power
            </h1>
            <p class="text-lg sm:text-xl text-gray-400 max-w-3xl mx-auto mb-8">
                The fastest and cheapest source for in-game currency, premium items, and Box Live subscriptions. Get instant delivery, guaranteed security.
            </p>
            <div class="space-y-4 sm:space-y-0 sm:space-x-4 flex flex-col sm:flex-row justify-center mb-12">
                <button class="glow-button bg-accent-green text-primary-dark font-semibold px-8 py-3 rounded-xl shadow-lg hover:bg-green-500 transition duration-300" onclick="scrollToElement('products')">
                    Browse Deals Now
                </button>
                <a href="#features" class="glow-button bg-secondary-dark text-text-light border border-accent-green/50 font-semibold px-8 py-3 rounded-xl shadow-lg hover:bg-secondary-dark/80 transition duration-300 flex items-center justify-center">
                    Learn More
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="ml-2"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                </a>
            </div>
        </section>

        <section id="products" class="py-12 md:py-20 scroll-mt-24">
            <h2 class="text-3xl sm:text-4xl font-bold mb-10 text-center border-b border-accent-green/50 pb-4">Our Top Deals</h2>
            <div id="products-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- JavaScript will inject product cards here -->
            </div>
        </section>

        <section id="features" class="py-12 md:py-20 scroll-mt-24">
            <h2 class="text-3xl sm:text-4xl font-bold mb-10 text-center border-b border-accent-green/50 pb-4">Why Choose PicoPay?</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 text-center">
                <div class="bg-secondary-dark p-6 rounded-xl shadow-lg border border-accent-green/10">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mx-auto mb-3"><polygon points="12 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
                    <h3 class="font-semibold text-xl mb-2 text-text-light">Instant Delivery</h3>
                    <p class="text-gray-400 text-sm">Codes and currency delivered in seconds, not hours.</p>
                </div>
                <div class="bg-secondary-dark p-6 rounded-xl shadow-lg border border-accent-green/10">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mx-auto mb-3"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                    <h3 class="font-semibold text-xl mb-2 text-text-light">Unbeatable Prices</h3>
                    <p class="text-gray-400 text-sm">We guarantee the lowest market rates on all items.</p>
                </div>
                <div class="bg-secondary-dark p-6 rounded-xl shadow-lg border border-accent-green/10">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mx-auto mb-3"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                    <h3 class="font-semibold text-xl mb-2 text-text-light">100% Secure</h3>
                    <p class="text-gray-400 text-sm">All transactions are secured with industry-leading encryption.</p>
                </div>
                <div class="bg-secondary-dark p-6 rounded-xl shadow-lg border border-accent-green/10">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 mx-auto mb-3"><path d="M3 18v-6a9 9 0 0 1 18 0v6"></path><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path></svg>
                    <h3 class="font-semibold text-xl mb-2 text-text-light">24/7 Support</h3>
                    <p class="text-gray-400 text-sm">Our expert team is always ready to assist you via chat or email.</p>
                </div>
            </div>
        </section>

        <section id="contact" class="py-12 md:py-20 text-center bg-secondary-dark rounded-xl shadow-2xl mt-12 border border-accent-green/10">
            <h2 class="text-3xl font-bold mb-4 text-accent-green">Ready to Level Up?</h2>
            <p class="text-lg text-gray-400 max-w-2xl mx-auto mb-8">
                Join thousands of satisfied gamers who trust PicoPay for their in-game needs. Click below to start saving!
            </p>
            <button class="glow-button bg-accent-green text-primary-dark font-semibold px-10 py-4 rounded-xl shadow-lg hover:bg-green-500 transition duration-300 text-xl" onclick="scrollToElement('products')">
                Start Shopping
            </button>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-secondary-dark/50 mt-16 border-t border-accent-green/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-gray-400 text-sm">
            <p>&copy; 2025 PicoPay. All rights reserved.</p>
            <div class="mt-2 space-x-4">
                <button class="hover:text-accent-green transition duration-300 underline" onclick="openPrivacyModal()">Privacy Policy</button>
                <button onclick="openTermsModal()" class="hover:text-accent-green transition duration-300 underline">Terms of Service</button>
            </div>
        </div>
    </footer>

    <!-- Global Message Box (Custom Modal) -->
    <div id="message-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[110]">
        <div class="bg-secondary-dark p-6 rounded-xl shadow-2xl max-w-sm w-full border border-accent-green/50 transform transition-all duration-300 modal-content-hidden" id="message-modal-content">
            <h3 class="text-xl font-bold mb-3 text-accent-green">Notification</h3>
            <p id="modal-message" class="text-text-light mb-6"></p>
            <div class="flex justify-end">
                <button class="bg-accent-green text-primary-dark font-semibold px-4 py-2 rounded-lg hover:bg-green-500 transition duration-300" onclick="closeMessageModal()">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Auth Modal (Sign In / Register) -->
    <div id="auth-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[100] p-4">
        <div class="bg-secondary-dark p-8 rounded-xl shadow-2xl max-w-md w-full border border-accent-green/50 transform transition-all duration-300 modal-content-hidden" id="auth-modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 id="auth-title" class="text-2xl font-bold text-accent-green">Sign In</h3>
                <button class="text-gray-400 hover:text-red-500" onclick="closeAuthModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Email</label>
                    <input type="email" id="auth-email" class="w-full bg-primary-dark border border-gray-700 rounded-lg px-4 py-2 text-text-light focus:border-accent-green focus:outline-none focus:ring-1 focus:ring-accent-green" placeholder="you@example.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Password</label>
                    <input type="password" id="auth-password" class="w-full bg-primary-dark border border-gray-700 rounded-lg px-4 py-2 text-text-light focus:border-accent-green focus:outline-none focus:ring-1 focus:ring-accent-green" placeholder="••••••••">
                </div>
                
                <button id="auth-submit-btn" class="w-full glow-button bg-accent-green text-primary-dark font-semibold py-3 rounded-lg shadow-lg hover:bg-green-500 transition duration-300" onclick="handleAuthSubmit()">
                    Sign In
                </button>
                
                <p class="text-center text-sm text-gray-400 mt-4">
                    <span id="auth-toggle-text">Don't have an account?</span>
                    <button id="auth-toggle-btn" class="text-accent-green hover:underline ml-1" onclick="toggleAuthMode()">Register</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Guest Checkout Modal -->
    <div id="guest-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[105] p-4">
        <div class="bg-secondary-dark p-6 rounded-xl shadow-2xl max-w-sm w-full border border-accent-green/50 transform transition-all duration-300 modal-content-hidden" id="guest-modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-accent-green">Guest Checkout</h3>
                <button class="text-gray-400 hover:text-red-500" onclick="closeGuestModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <p class="text-gray-400 text-sm mb-4">Enter your Gamertag to receive your items instantly without an account.</p>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-400 mb-1">Gamertag / Username</label>
                <input type="text" id="guest-gamertag" oninput="document.getElementById('guest-error').classList.add('hidden')" class="w-full bg-primary-dark border border-gray-700 rounded-lg px-4 py-2 text-text-light focus:border-accent-green focus:outline-none focus:ring-1 focus:ring-accent-green" placeholder="e.g. ProGamer123">
                <p id="guest-error" class="text-red-500 text-xs mt-1 hidden">Gamertag is required.</p>
            </div>
            <button id="guest-checkout-btn" class="w-full glow-button bg-accent-green text-primary-dark font-semibold py-3 rounded-lg shadow-lg hover:bg-green-500 transition duration-300" onclick="handleGuestCheckout()">
                Continue to Payment
            </button>
            <div class="mt-4 text-center border-t border-accent-green/20 pt-4">
                <p class="text-sm text-gray-400 mb-2">Want to save your order history?</p>
                <button class="text-accent-green hover:underline text-sm font-semibold" onclick="switchToAuthFromGuest()">Sign In / Register</button>
            </div>
        </div>
    </div>

    <!-- ADMIN DASHBOARD MODAL -->
    <div id="admin-dashboard-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[110] p-4">
        <div class="bg-secondary-dark p-6 rounded-xl shadow-2xl max-w-4xl w-full h-[80vh] flex flex-col border border-accent-yellow/50 transform transition-all duration-300 modal-content-hidden" id="admin-dashboard-modal-content">
            <div class="flex justify-between items-center mb-6 border-b border-accent-yellow/30 pb-3">
                <div class="flex items-center gap-4">
                    <h3 class="text-2xl font-bold text-accent-yellow">Product Dashboard</h3>
                    <button onclick="openAdminAddModal()" class="bg-accent-green text-primary-dark font-bold text-xs px-3 py-1 rounded hover:bg-green-400 transition shadow-lg">
                        + Add Product
                    </button>
                </div>
                <button class="text-gray-400 hover:text-red-500" onclick="closeAdminDashboard()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="overflow-y-auto flex-grow">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-primary-dark text-accent-yellow text-sm uppercase">
                        <tr>
                            <th class="p-3 rounded-tl-lg">ID</th>
                            <th class="p-3">Name</th>
                            <th class="p-3">Price</th>
                            <th class="p-3 rounded-tr-lg text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="admin-product-list" class="divide-y divide-gray-700 text-sm">
                        <!-- Rows injected via JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Admin Product Edit/Add Modal -->
    <div id="admin-product-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[120] p-4">
        <div class="bg-secondary-dark p-6 rounded-xl shadow-2xl max-w-md w-full border border-accent-yellow/50 transform transition-all duration-300 modal-content-hidden" id="admin-product-modal-content">
            <div class="flex justify-between items-center mb-6 border-b border-accent-yellow/30 pb-3">
                <h3 id="admin-modal-title" class="text-xl font-bold text-accent-yellow">Edit Product</h3>
                <button class="text-gray-400 hover:text-red-500" onclick="closeAdminProductModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <input type="hidden" id="admin-edit-id">

            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Product Name</label>
                    <input type="text" id="admin-edit-name" class="w-full bg-primary-dark border border-gray-700 rounded-lg px-4 py-2 text-text-light focus:border-accent-yellow focus:outline-none focus:ring-1 focus:ring-accent-yellow" placeholder="e.g. 5000 Gold Coins">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Description</label>
                    <textarea id="admin-edit-desc" rows="3" class="w-full bg-primary-dark border border-gray-700 rounded-lg px-4 py-2 text-text-light focus:border-accent-yellow focus:outline-none focus:ring-1 focus:ring-accent-yellow" placeholder="Product details..."></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Price ($)</label>
                        <input type="number" step="0.01" id="admin-edit-price" class="w-full bg-primary-dark border border-gray-700 rounded-lg px-4 py-2 text-text-light focus:border-accent-yellow focus:outline-none focus:ring-1 focus:ring-accent-yellow">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1">Original Price ($)</label>
                        <input type="number" step="0.01" id="admin-edit-original-price" class="w-full bg-primary-dark border border-gray-700 rounded-lg px-4 py-2 text-text-light focus:border-accent-yellow focus:outline-none focus:ring-1 focus:ring-accent-yellow">
                    </div>
                </div>

                <div class="pt-4 flex justify-end space-x-3">
                    <button class="text-gray-400 hover:text-white px-4 py-2" onclick="closeAdminProductModal()">Cancel</button>
                    <button class="admin-glow-button bg-accent-yellow text-primary-dark font-bold px-6 py-2 rounded-lg" onclick="saveProductChanges()">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Shopping Cart Modal -->
    <div id="cart-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[100]">
        <div class="bg-secondary-dark p-6 rounded-xl shadow-2xl max-w-lg w-full border border-accent-green/50 transform transition-all duration-300 modal-content-hidden mx-4" id="cart-modal-content">
            <div class="flex justify-between items-center mb-4 border-b border-accent-green/50 pb-2">
                <h3 class="text-2xl font-bold text-accent-green">Your Cart</h3>
                <button class="text-gray-400 hover:text-red-500" onclick="closeCartModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <div id="cart-items-container" class="space-y-4 max-h-80 overflow-y-auto pr-2 mb-4 scrollbar-thin scrollbar-thumb-accent-green scrollbar-track-secondary-dark">
                <!-- Cart items will be injected here via JS -->
            </div>

            <div id="cart-summary" class="border-t border-accent-green/50 pt-4">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-xl font-bold">Total:</span>
                    <span id="cart-total" class="text-3xl font-extrabold text-accent-green">$0.00</span>
                </div>
                <button id="checkout-button" class="w-full glow-button bg-accent-green text-primary-dark font-semibold py-3 rounded-lg shadow-lg hover:bg-green-500 transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed" onclick="checkout()">
                    Proceed to Checkout
                </button>
            </div>
        </div>
    </div>
    
    <!-- Terms & Privacy Modals -->
    <div id="terms-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[100] p-4">
        <div class="bg-secondary-dark p-6 rounded-xl shadow-2xl max-w-3xl w-full h-full max-h-[80vh] flex flex-col border border-accent-green/50 transform transition-all duration-300 modal-content-hidden" id="terms-modal-content">
            <div class="flex justify-between items-center mb-4 border-b border-accent-green/50 pb-2 flex-shrink-0">
                <h3 class="text-2xl font-bold text-accent-green">PicoPay - Terms of Service</h3>
                <button class="text-gray-400 hover:text-red-500" onclick="closeTermsModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="overflow-y-auto flex-grow pr-2 text-gray-300 space-y-4 text-sm scrollbar-thin scrollbar-thumb-accent-green scrollbar-track-secondary-dark">
                <p><strong>1. Introduction</strong><br>Welcome to PicoPay. By accessing our website, you agree to be bound by these Terms of Service, all applicable laws and regulations, and agree that you are responsible for compliance with any applicable local laws.</p>
                <p><strong>2. Use License</strong><br>Permission is granted to temporarily download one copy of the materials (information or software) on PicoPay's website for personal, non-commercial transitory viewing only.</p>
                <p><strong>3. Digital Goods</strong><br>All digital goods (currency, codes, subscriptions) are delivered electronically. Due to the nature of these items, refunds are generally not accepted once the code has been viewed or redeemed.</p>
                <p><strong>4. User Accounts</strong><br>You are responsible for maintaining the confidentiality of your account and password. You agree to accept responsibility for all activities that occur under your account.</p>
                <p><strong>5. Pricing</strong><br>Prices for our products are subject to change without notice. We reserve the right at any time to modify or discontinue the Service (or any part or content thereof) without notice at any time.</p>
                <p><strong>6. Limitation of Liability</strong><br>In no event shall PicoPay or its suppliers be liable for any damages (including, without limitation, damages for loss of data or profit, or due to business interruption) arising out of the use or inability to use the materials on PicoPay's website.</p>
                <br>
                <p class="italic text-xs text-gray-500">Last updated: October 2025</p>
            </div>
            <div class="mt-6 border-t border-accent-green/50 pt-4 flex justify-end">
                <button class="bg-accent-green text-primary-dark font-bold px-6 py-2 rounded-lg hover:bg-green-500 transition duration-300" onclick="closeTermsModal()">I Understand</button>
            </div>
        </div>
    </div>

    <div id="privacy-modal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-[100] p-4">
        <div class="bg-secondary-dark p-6 rounded-xl shadow-2xl max-w-3xl w-full h-full max-h-[80vh] flex flex-col border border-accent-green/50 transform transition-all duration-300 modal-content-hidden" id="privacy-modal-content">
            <div class="flex justify-between items-center mb-4 border-b border-accent-green/50 pb-2 flex-shrink-0">
                <h3 class="text-2xl font-bold text-accent-green">Privacy Policy</h3>
                <button class="text-gray-400 hover:text-red-500" onclick="closePrivacyModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="overflow-y-auto flex-grow pr-2 text-gray-300 space-y-4 text-sm scrollbar-thin scrollbar-thumb-accent-green scrollbar-track-secondary-dark">
                <p><strong>1. Information Collection</strong><br>We collect information from you when you register on our site, place an order, subscribe to our newsletter, or fill out a form. The data collected includes your name, email address, and payment details.</p>
                <p><strong>2. Information Usage</strong><br>Any of the information we collect from you may be used in one of the following ways: to personalize your experience, to improve our website, to improve customer service, to process transactions, and to send periodic emails.</p>
                <p><strong>3. Data Protection</strong><br>We implement a variety of security measures to maintain the safety of your personal information when you place an order or enter, submit, or access your personal information. We use SSL encryption for all sensitive data.</p>
                <p><strong>4. Cookies</strong><br>We use cookies to help us remember and process the items in your shopping cart and understand and save your preferences for future visits.</p>
                <p><strong>5. Third Party Disclosure</strong><br>We do not sell, trade, or otherwise transfer to outside parties your personally identifiable information. This does not include trusted third parties who assist us in operating our website, conducting our business, or servicing you.</p>
                <br>
                <p class="italic text-xs text-gray-500">Your privacy is important to us.</p>
            </div>
            <div class="mt-6 border-t border-accent-green/50 pt-4 flex justify-end">
                <button class="bg-accent-green text-primary-dark font-bold px-6 py-2 rounded-lg hover:bg-green-500 transition duration-300" onclick="closePrivacyModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // Initial Product Data
        const initialProducts = [
            { id: 1, name: "1000 V-Bucks", price: 7.99, originalPrice: 9.99, description: "Essential currency for skins and battle passes.", image: "" },
            { id: 2, name: "2800 V-Bucks", price: 19.99, originalPrice: 24.99, description: "Get that legendary skin you've been eyeing.", image: "" },
            { id: 3, name: "13500 V-Bucks", price: 79.99, originalPrice: 89.99, description: "The ultimate bundle for serious gamers.", image: "" },
            { id: 4, name: "Box Live Gold (12 Month)", price: 49.99, originalPrice: 59.99, description: "Multiplayer access and free games monthly.", image: "" },
            { id: 5, name: "Box Game Pass Ultimate (1 Month)", price: 12.99, originalPrice: 14.99, description: "Access to over 100 high-quality games.", image: "" },
            { id: 6, name: "Apex Coins (1000)", price: 8.50, originalPrice: 9.99, description: "Grab the latest Battle Pass instantly.", image: "" },
            { id: 7, name: "Robux (800)", price: 9.49, originalPrice: 9.99, description: "Upgrade your avatar and buy abilities.", image: "" },
            { id: 8, name: "Steam Gift Card ($50)", price: 47.50, originalPrice: 50.00, description: "Wallet top-up for the Steam store.", image: "" },
            { id: 9, name: "Valorant Points (2050)", price: 18.99, originalPrice: 19.99, description: "Unlock agents and weapon skins.", image: "" }
        ];

        // State Variables
        let products = JSON.parse(localStorage.getItem('picopay_products')) || initialProducts;
        let cart = JSON.parse(localStorage.getItem('picopay_cart')) || [];
        let currentUser = JSON.parse(localStorage.getItem('picopay_user')) || null;

        // Icon Generator
        function getProductIcon(name) {
            if (name.includes("V-Bucks")) return `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`;
            if (name.includes("Box")) return `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line></svg>`;
            if (name.includes("Apex")) return `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>`;
            if (name.includes("Steam")) return `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a10 10 0 0 1 7.74 16.36L14.3 11.3a2.5 2.5 0 0 0-2.6-2.6L4.36 15.06A10 10 0 1 1 12 2z"></path></svg>`;
            return `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>`;
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            renderProducts();
            updateCartUI();
            checkUserSession();
        });

        // Rendering
        function renderProducts() {
            const container = document.getElementById('products-grid');
            container.innerHTML = '';
            products.forEach(product => {
                const discount = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                const card = document.createElement('div');
                card.className = 'bg-secondary-dark rounded-xl shadow-lg overflow-hidden border border-accent-green/10 hover:border-accent-green/40 transition duration-300 flex flex-col relative group';
                card.innerHTML = `
                    <div class="absolute top-2 right-2 bg-red-600 text-white text-xs font-bold px-2 py-1 rounded-full z-10">-${discount}%</div>
                    <div class="h-48 bg-gray-800 flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-accent-green/5 group-hover:bg-accent-green/10 transition duration-300"></div>
                        <div class="transform group-hover:scale-110 transition duration-300">
                            ${getProductIcon(product.name)}
                        </div>
                    </div>
                    <div class="p-6 flex flex-col flex-grow">
                        <h3 class="text-xl font-bold mb-2 text-text-light line-clamp-1" title="${product.name}">${product.name}</h3>
                        <p class="text-gray-400 text-sm mb-4 flex-grow line-clamp-2">${product.description}</p>
                        <div class="flex items-end justify-between mt-auto">
                            <div>
                                <span class="text-gray-500 line-through text-sm">$${product.originalPrice.toFixed(2)}</span>
                                <div class="text-2xl font-bold text-accent-green glow-text">$${product.price.toFixed(2)}</div>
                            </div>
                            <button 
                                class="add-to-cart-btn bg-accent-green text-primary-dark p-3 rounded-lg hover:bg-white hover:text-accent-green transition duration-300 shadow-md transform active:scale-95"
                                onclick="addToCart(${product.id}, this)"
                                aria-label="Add ${product.name} to cart"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path><line x1="12" y1="8" x2="12" y2="12"></line><line x1="10" y1="10" x2="14" y2="10"></line></svg>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Cart Logic
        function addToCart(id, btnElement) {
            const product = products.find(p => p.id === id);
            const existingItem = cart.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCartUI();
            saveCart();
            triggerFlyAnimation(btnElement);
            shakeCartIcon();
            // showAlert removed as per request
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            updateCartUI();
            saveCart();
            renderCartItems();
        }

        function updateQuantity(id, delta) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.quantity += delta;
                if (item.quantity <= 0) {
                    removeFromCart(id);
                } else {
                    updateCartUI();
                    saveCart();
                    renderCartItems();
                }
            }
        }

        function saveCart() {
            localStorage.setItem('picopay_cart', JSON.stringify(cart));
        }

        function updateCartUI() {
            const totalCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            // Update Desktop Badge
            const desktopBadge = document.getElementById('cart-count-desktop');
            desktopBadge.textContent = totalCount;
            desktopBadge.classList.toggle('scale-0', totalCount === 0);
            desktopBadge.classList.toggle('scale-100', totalCount > 0);

            // Update Mobile Menu Badge
            const mobileBadge = document.getElementById('cart-count-mobile');
            mobileBadge.textContent = totalCount;
            mobileBadge.classList.toggle('scale-0', totalCount === 0);
            mobileBadge.classList.toggle('scale-100', totalCount > 0);

            // Update Mobile Header Badge
            const mobileHeaderBadge = document.getElementById('cart-count-mobile-header');
            mobileHeaderBadge.textContent = totalCount;
            mobileHeaderBadge.classList.toggle('scale-0', totalCount === 0);
            mobileHeaderBadge.classList.toggle('scale-100', totalCount > 0);
        }

        function renderCartItems() {
            const container = document.getElementById('cart-items-container');
            const totalEl = document.getElementById('cart-total');
            const checkoutBtn = document.getElementById('checkout-button');

            container.innerHTML = ''; // Clear current content
            let total = 0;

            if (cart.length === 0) {
                // Inject Empty Message Dynamically
                container.innerHTML = '<p class="text-gray-500 italic text-center py-4">Your cart is empty. Time to shop!</p>';
                
                checkoutBtn.disabled = true;
                checkoutBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                checkoutBtn.disabled = false;
                checkoutBtn.classList.remove('opacity-50', 'cursor-not-allowed');

                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;

                    const itemEl = document.createElement('div');
                    itemEl.className = 'flex items-center justify-between bg-primary-dark p-3 rounded-lg border border-accent-green/20';
                    itemEl.innerHTML = `
                        <div class="flex flex-col">
                            <span class="font-semibold text-sm">${item.name}</span>
                            <span class="text-xs text-gray-400">$${item.price.toFixed(2)} x ${item.quantity}</span>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="flex items-center bg-secondary-dark rounded-lg border border-gray-700">
                                <button onclick="updateQuantity(${item.id}, -1)" class="px-2 py-1 text-gray-400 hover:text-white">-</button>
                                <span class="text-sm font-bold px-1">${item.quantity}</span>
                                <button onclick="updateQuantity(${item.id}, 1)" class="px-2 py-1 text-accent-green hover:text-white">+</button>
                            </div>
                            <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-400">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                            </button>
                        </div>
                    `;
                    container.appendChild(itemEl);
                });
            }

            totalEl.textContent = `$${total.toFixed(2)}`;
        }

        // --- Checkout & Auth Logic ---
        // AUTHENTICATION LOGIC
        function handleAuthClick() {
            if (currentUser) {
                logout();
            } else {
                openAuthModal();
            }
        }

        function checkUserSession() {
            const deskBtn = document.getElementById('auth-btn-desktop');
            const mobBtn = document.getElementById('auth-btn-mobile');
            const adminBtn = document.getElementById('admin-dashboard-btn');
            const adminBtnMobile = document.getElementById('admin-dashboard-btn-mobile');

            if (currentUser) {
                if (deskBtn) deskBtn.textContent = `Logout (${currentUser.name})`;
                if (mobBtn) mobBtn.textContent = `Logout (${currentUser.name})`;
                
                if (currentUser.role === 'admin') {
                    if (adminBtn) adminBtn.classList.remove('hidden');
                    if (adminBtnMobile) adminBtnMobile.classList.remove('hidden');
                } else {
                    if (adminBtn) adminBtn.classList.add('hidden');
                    if (adminBtnMobile) adminBtnMobile.classList.add('hidden');
                }
            } else {
                if (deskBtn) deskBtn.textContent = 'Sign In';
                if (mobBtn) mobBtn.textContent = 'Sign In';
                if (adminBtn) adminBtn.classList.add('hidden');
                if (adminBtnMobile) adminBtnMobile.classList.add('hidden');
            }
        }

        function handleAuthSubmit() {
            const emailInput = document.getElementById('auth-email');
            const passInput = document.getElementById('auth-password');
            const titleEl = document.getElementById('auth-title');
            const btn = document.getElementById('auth-submit-btn');

            if (!emailInput || !passInput) return;

            const email = emailInput.value.trim();
            const password = passInput.value.trim();
            const title = titleEl ? titleEl.innerText : "Sign In";

            if (!email || !password) {
                showAlert("Please fill in all fields"); 
                return;
            }

            // Visual feedback
            const originalText = btn.innerText;
            btn.innerText = "Processing...";
            btn.disabled = true;

            setTimeout(() => {
                let role = 'user';
                let name = email.split('@')[0];

                // Admin Check
                if (email === 'admin@picopay.com' && password === 'admin') {
                    role = 'admin';
                    name = 'Admin';
                }

                currentUser = {
                    id: Date.now(),
                    email: email,
                    name: name,
                    role: role
                };

                localStorage.setItem('picopay_user', JSON.stringify(currentUser));
                checkUserSession();
                closeAuthModal();
                
                // Reset Button
                btn.innerText = originalText;
                btn.disabled = false;

                if (role === 'admin') {
                    showAlert(`Welcome Commander! Admin Panel Unlocked.`);
                } else {
                    showAlert(title === 'Sign In' ? `Welcome back, ${name}!` : `Account created! Welcome, ${name}.`);
                }
            }, 800); // Slight delay for effect
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('picopay_user');
            checkUserSession();
            showAlert("Logged out successfully.");
        }

        function toggleAuthMode() {
            const title = document.getElementById('auth-title');
            const btn = document.getElementById('auth-submit-btn');
            const toggleText = document.getElementById('auth-toggle-text');
            const toggleBtn = document.getElementById('auth-toggle-btn');

            if (title.innerText === 'Sign In') {
                title.innerText = 'Register';
                btn.innerText = 'Create Account';
                toggleText.innerText = 'Already have an account?';
                toggleBtn.innerText = 'Sign In';
            } else {
                title.innerText = 'Sign In';
                btn.innerText = 'Sign In';
                toggleText.innerText = "Don't have an account?";
                toggleBtn.innerText = 'Register';
            }
        }

        // Checkout & Guest Logic
        function checkout() {
            if (cart.length === 0) return;
            closeCartModal();
            if (currentUser) {
                showAlert("Processing Payment...", 2000);
                setTimeout(() => {
                    completeOrder(currentUser.name);
                }, 2000);
            } else {
                openGuestModal();
            }
        }

        function completeOrder(recipient) {
            // This function finalizes the order, regardless of guest or logged-in checkout
            showAlert(`Payment successful. Finalizing order for ${recipient}...`, 2000);

            // Finalize the order after a short delay
            setTimeout(() => {
                cart = [];
                saveCart();
                updateCartUI();
                const deliveryMessage = currentUser 
                    ? "Order Complete! Codes sent to your registered email."
                    : "Order Complete! Your items have been sent to your Gamertag inbox.";
                showAlert(deliveryMessage);
            }, 2000);
        }

        function handleGuestCheckout() {
            const gamertagInput = document.getElementById('guest-gamertag');
            const gamertag = gamertagInput.value.trim();
            const error = document.getElementById('guest-error');

            if(!gamertag) {
                error.innerText = "Gamertag is required.";
                error.classList.remove('hidden');
                return;
            }

            if(gamertag.length < 3) {
                error.innerText = "Gamertag must be at least 3 characters.";
                error.classList.remove('hidden');
                return;
            }

            // Validation: Cannot start with a number
            if (/^\d/.test(gamertag)) {
                error.innerText = "Gamertag cannot start with a number.";
                error.classList.remove('hidden');
                return;
            }

            // Regex validation: Allow Alphanumeric, Underscore, Hyphen, AND Dot
            const validChars = /^[a-zA-Z0-9_.-]+$/;
            if (!validChars.test(gamertag)) {
                error.innerText = "Gamertag can only contain letters, numbers, underscores (_), hyphens (-), and dots (.).";
                error.classList.remove('hidden');
                return;
            }

            error.classList.add('hidden');
            
            closeGuestModal();
            
            // STEP 1: Simulate Redirect to Payment Gateway
            showAlert(`Gamertag accepted: ${gamertag}. Simulating redirect to PayPal/Payment Gateway...`, 3000);

            // STEP 2: Simulate Payment Success after a delay
            setTimeout(() => {
                completeOrder(gamertag); // Call the finalization function
            }, 3000);
        }
        
        function switchToAuthFromGuest() {
            closeGuestModal();
            openAuthModal();
        }

        // Admin Dashboard Logic
        function openAdminDashboard() {
            const modal = document.getElementById('admin-dashboard-modal');
            const content = document.getElementById('admin-dashboard-modal-content');
            renderAdminProductList();
            openModal(modal, content);
        }

        function closeAdminDashboard() {
            const modal = document.getElementById('admin-dashboard-modal');
            const content = document.getElementById('admin-dashboard-modal-content');
            closeModal(modal, content);
        }

        function renderAdminProductList() {
            const tbody = document.getElementById('admin-product-list');
            tbody.innerHTML = '';
            products.forEach(p => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-white/5 transition border-b border-gray-800';
                tr.innerHTML = `
                    <td class="p-3 text-gray-400">#${p.id}</td>
                    <td class="p-3 font-semibold text-white">${p.name}</td>
                    <td class="p-3 text-accent-green">$${p.price.toFixed(2)}</td>
                    <td class="p-3 text-right space-x-3">
                        <button onclick="openAdminEditModal(${p.id})" class="text-accent-yellow hover:text-white text-sm font-medium transition">Edit</button>
                        <button onclick="deleteProduct(${p.id})" class="text-red-500 hover:text-red-300 text-sm font-medium transition">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function openAdminAddModal() {
            document.getElementById('admin-modal-title').innerText = "Add New Product";
            document.getElementById('admin-edit-id').value = ""; 
            document.getElementById('admin-edit-name').value = "";
            document.getElementById('admin-edit-desc').value = "";
            document.getElementById('admin-edit-price').value = "";
            document.getElementById('admin-edit-original-price').value = "";
            const modal = document.getElementById('admin-product-modal');
            const content = document.getElementById('admin-product-modal-content');
            openModal(modal, content);
        }

        function openAdminEditModal(id) {
            const product = products.find(p => p.id === id);
            if (!product) return;
            document.getElementById('admin-modal-title').innerText = "Edit Product";
            document.getElementById('admin-edit-id').value = product.id;
            document.getElementById('admin-edit-name').value = product.name;
            document.getElementById('admin-edit-desc').value = product.description;
            document.getElementById('admin-edit-price').value = product.price;
            document.getElementById('admin-edit-original-price').value = product.originalPrice;
            const modal = document.getElementById('admin-product-modal');
            const content = document.getElementById('admin-product-modal-content');
            openModal(modal, content);
        }

        function closeAdminProductModal() {
             const modal = document.getElementById('admin-product-modal');
            const content = document.getElementById('admin-product-modal-content');
            closeModal(modal, content);
        }

        function deleteProduct(id) {
            // NOTE: Replaced confirm() with a direct delete and notification.
            products = products.filter(p => p.id !== id);
            localStorage.setItem('picopay_products', JSON.stringify(products));
            renderProducts();
            renderAdminProductList();
            showAlert("Product deleted successfully.");
        }

        function saveProductChanges() {
            const idVal = document.getElementById('admin-edit-id').value;
            const name = document.getElementById('admin-edit-name').value;
            const desc = document.getElementById('admin-edit-desc').value;
            const price = parseFloat(document.getElementById('admin-edit-price').value);
            const origPrice = parseFloat(document.getElementById('admin-edit-original-price').value);

            if (!name || isNaN(price)) {
                showAlert("Please enter a valid name and price."); // FIXED: Replaced alert()
                return;
            }

            if (idVal) {
                // Update
                const id = parseInt(idVal);
                const index = products.findIndex(p => p.id === id);
                if (index !== -1) {
                    products[index] = { ...products[index], name, description: desc, price, originalPrice: origPrice };
                    showAlert("Product updated successfully!");
                }
            } else {
                // Create
                const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                const newProduct = {
                    id: newId,
                    name: name,
                    description: desc,
                    price: price,
                    originalPrice: origPrice || price,
                    image: ""
                };
                products.push(newProduct);
                showAlert("New product added!");
            }
            localStorage.setItem('picopay_products', JSON.stringify(products));
            renderProducts();
            renderAdminProductList();
            closeAdminProductModal();
        }

        // UI Utilities
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
            } else {
                menu.classList.add('hidden');
            }
        }

        function scrollToElement(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        function showAlert(message, duration = 0) {
            // Re-purposed to use the modal since the banner was removed
            openMessageModal(message);
            if (duration > 0) {
                setTimeout(() => {
                    closeMessageModal();
                }, duration);
            }
        }

        // Modal Helpers
        function openModal(modal, content) {
            modal.classList.remove('hidden');
            setTimeout(() => {
                content.classList.remove('modal-content-hidden');
                content.classList.add('modal-content-visible');
            }, 10);
        }

        function closeModal(modal, content) {
            content.classList.remove('modal-content-visible');
            content.classList.add('modal-content-hidden');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        function openCartModal() { renderCartItems(); openModal(document.getElementById('cart-modal'), document.getElementById('cart-modal-content')); }
        function closeCartModal() { closeModal(document.getElementById('cart-modal'), document.getElementById('cart-modal-content')); }
        function openAuthModal() { openModal(document.getElementById('auth-modal'), document.getElementById('auth-modal-content')); }
        function closeAuthModal() { closeModal(document.getElementById('auth-modal'), document.getElementById('auth-modal-content')); }
        function openGuestModal() { openModal(document.getElementById('guest-modal'), document.getElementById('guest-modal-content')); }
        function closeGuestModal() { closeModal(document.getElementById('guest-modal'), document.getElementById('guest-modal-content')); }
        function openPrivacyModal() { openModal(document.getElementById('privacy-modal'), document.getElementById('privacy-modal-content')); }
        function closePrivacyModal() { closeModal(document.getElementById('privacy-modal'), document.getElementById('privacy-modal-content')); }
        function openTermsModal() { openModal(document.getElementById('terms-modal'), document.getElementById('terms-modal-content')); }
        function closeTermsModal() { closeModal(document.getElementById('terms-modal'), document.getElementById('terms-modal-content')); }
        function openMessageModal(text) { document.getElementById('modal-message').innerText = text; openModal(document.getElementById('message-modal'), document.getElementById('message-modal-content')); }
        function closeMessageModal() { closeModal(document.getElementById('message-modal'), document.getElementById('message-modal-content')); }

        // Animations
        function triggerFlyAnimation(startEl) {
            const cartIcon = window.innerWidth < 768 ? document.getElementById('cart-icon-mobile') : document.getElementById('cart-icon-desktop');
            if (!startEl || !cartIcon) return;
            const startRect = startEl.getBoundingClientRect();
            const endRect = cartIcon.getBoundingClientRect();
            const flyer = document.createElement('div');
            flyer.classList.add('fly-item');
            flyer.style.top = `${startRect.top + startRect.height/2 - 10}px`;
            flyer.style.left = `${startRect.left + startRect.width/2 - 10}px`;
            document.body.appendChild(flyer);
            requestAnimationFrame(() => {
                flyer.style.top = `${endRect.top + endRect.height/2 - 10}px`;
                flyer.style.left = `${endRect.left + endRect.width/2 - 10}px`;
                flyer.style.opacity = '0';
                flyer.style.transform = 'scale(0.1)';
            });
            setTimeout(() => { if(flyer.parentNode) flyer.parentNode.removeChild(flyer); }, 800);
        }

        function shakeCartIcon() {
            const desk = document.getElementById('cart-icon-desktop');
            const mob = document.getElementById('cart-icon-mobile');
            if (desk) desk.classList.add('cart-shake');
            if (mob) mob.classList.add('cart-shake');
            setTimeout(() => {
                if (desk) desk.classList.remove('cart-shake');
                if (mob) mob.classList.remove('cart-shake');
            }, 400);
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal-backdrop')) {
                const modals = document.querySelectorAll('.modal-backdrop:not(.hidden)');
                modals.forEach(modal => {
                    const content = modal.firstElementChild;
                    closeModal(modal, content);
                });
            }
        }
    </script>
</body>
</html>
